---
title: "하드 디스크 고장"
description: "RustFS는 이레이저 코딩과 유사한 메커니즘을 통해 일부 디스크 장애 시에도 읽기/쓰기 액세스를 제공하고, 디스크 교체 후 자동으로 데이터를 복구합니다."
---

# 하드 디스크 고장

RustFS는 이레이저 코딩과 유사한 메커니즘을 통해 일부 디스크 장애 시에도 읽기/쓰기 액세스를 제공하고, 디스크 교체 후 자동으로 데이터를 복구합니다.

---

### 목차

1. [고장난 디스크 언마운트](#1-고장난-디스크-언마운트)
2. [고장난 디스크 교체](#2-고장난-디스크-교체)
3. [`/etc/fstab` 또는 RustFS 설정 업데이트](#3-etcfstab-또는-rustfs-설정-업데이트)
4. [새 디스크 재마운트](#4-새-디스크-재마운트)
5. [데이터 힐링 시작 및 모니터링](#5-데이터-힐링-시작-및-모니터링)
6. [후속 점검 및 주의사항](#6-후속-점검-및-주의사항)

---

### 1) 고장난 디스크 언마운트

물리적 하드 디스크를 교체하기 전에, 먼저 운영체제 수준에서 고장난 디스크를 안전하게 언마운트하여 교체 과정 중 파일시스템이나 RustFS에서 I/O 오류가 발생하지 않도록 해야 합니다.

```bash
# 고장난 디스크가 /dev/sdb라고 가정
umount /dev/sdb
```

> **설명**
>
> * 마운트 포인트가 여러 개 있는 경우 각각 `umount`를 실행하세요.
> * "장치가 사용 중" 오류가 발생하면 먼저 RustFS 서비스를 중지하세요:
>
> ```bash
> systemctl stop rustfs
> ```

---

### 2) 고장난 디스크 교체

물리적으로 고장난 디스크를 교체한 후, 새 디스크를 파티션하고 포맷하며, 기존 디스크와 동일한 라벨을 붙여야 합니다.

```bash
# ext4로 포맷하고 DISK1 라벨 부착 (기존 라벨과 일치해야 함)
mkfs.ext4 /dev/sdb -L DISK1
```

> **요구사항**
>
> * 새 디스크 용량 ≥ 기존 디스크 용량
> * 파일시스템 타입을 다른 디스크와 일치시키기
> * 시스템 재시작 시 디스크 순서가 영향받지 않도록 라벨(LABEL) 또는 UUID로 마운트하는 것을 권장

---

### 3) `/etc/fstab` 또는 RustFS 설정 업데이트

`/etc/fstab`의 마운트 항목 라벨 또는 UUID가 새 디스크를 가리키는지 확인합니다. RustFS 전용 설정 파일(`config.yaml` 등)을 사용하는 경우 해당 항목도 동기화하여 업데이트해야 합니다.

```bash
# 현재 fstab 확인
cat /etc/fstab

# fstab 항목 예시 (라벨이 동일한 경우 수정 불필요)
LABEL=DISK1 /mnt/disk1 ext4 defaults,noatime 0 2
```

> **팁**
>
> * UUID를 사용하는 경우:
>
> ```bash
> blkid /dev/sdb
> # 새 파티션의 UUID를 얻은 후 fstab의 해당 필드를 교체
> ```
> * fstab 수정 후 반드시 구문을 검증하세요:
>
> ```bash
> mount -a # 오류가 없으면 설정이 올바름
> ```

---

### 4) 새 디스크 재마운트

다음 명령을 실행하여 모든 디스크를 일괄 마운트하고 RustFS 서비스를 시작합니다:

```bash
mount -a
systemctl start rustfs
```

모든 디스크가 정상적으로 마운트되었는지 확인:

```bash
df -h | grep /mnt/disk
```

> **주의**
>
> * 일부 마운트가 실패한 경우 fstab 항목과 디스크 라벨/UUID가 일치하는지 확인하세요.

---

### 5) 데이터 힐링 시작 및 모니터링

RustFS가 새 디스크를 감지한 후 자동으로 또는 수동으로 데이터 힐링(heal) 프로세스를 시작합니다. 다음은 가상의 `rustfs-admin` 도구를 사용한 예시입니다:

```bash
# 현재 디스크 상태 확인
rustfs-admin disk status

# 새 디스크의 힐링을 수동으로 시작
rustfs-admin heal --disk /mnt/disk1

# 힐링 진행 상황을 실시간으로 확인
rustfs-admin heal status --follow
```

동시에 서비스 로그를 확인하여 시스템이 인식하고 데이터 복구를 시작했는지 확인할 수 있습니다:

```bash
# systemd 관리 설치의 경우
journalctl -u rustfs -f

# 또는 전용 로그 파일 확인
tail -f /var/log/rustfs/heal.log
```

> **설명**
>
> * 힐링 프로세스는 백그라운드에서 완료되며, 일반적으로 온라인 액세스에 미치는 영향은 극소합니다
> * 힐링 완료 후 도구는 성공을 보고하거나 실패한 객체를 나열합니다

---

### 6) 후속 점검 및 주의사항

1. **성능 모니터링**

   * 힐링 기간 중 I/O가 약간 변동할 수 있으므로 디스크 및 네트워크 부하 모니터링을 권장합니다.

2. **배치 고장**

   * 동일 배치 디스크에서 다중 고장이 발생하는 경우 더 빈번한 하드웨어 점검을 고려하세요.

3. **정기적 연습**

   * 정기적으로 디스크 고장을 시뮬레이션하는 연습을 통해 팀이 복구 프로세스에 익숙해지도록 하세요.

4. **유지보수 창**

   * 고장률이 높은 시기에는 전용 유지보수 창을 설정하여 교체 및 힐링 속도를 향상시키세요.

